# 浙江水利水电学院实验报告


### 实验内容及要求：
使用MVC模式开发一个数据库WEB应用，包含用户登录注册，图书（物品）管理（增删改查），和购物流程（加入购物车，生成订单）。

### 主要仪器名称及型号：
- PC
- IDEA

---

## 1. 实验目的和意义

本次实验的目的是让学生巩固如下知识与技能：
1. 掌握使用MVC（JSP+JavaBean+Servlet）模式开发一个WEB应用
2. 掌握在web应用中连接、访问MySql数据库（或SQL Server数据库）的方法

## 2. 技术要求

要求学生掌握JSP连接、访问MySql数据库（或SQL Server数据库）的方法；熟练使用JDBC API连接、访问数据库的常用接口与DriverManager类。

## 3. 项目结构

### 3.1 项目目录结构

```
iot-web-service/
├── pom.xml
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   ├── beans/
│   │   │   │   ├── Book.java         # 图书实体类
│   │   │   │   └── User.java         # 用户实体类
│   │   │   ├── dao/
│   │   │   │   ├── DataSourceUtil.java # 数据库连接工具类
│   │   │   │   └── DBUtils.java      # 数据库操作工具类
│   │   │   ├── filter/
│   │   │   │   └── encodingFilter.java # 编码过滤器
│   │   │   └── servlet/
│   │   │       ├── BookListServlet.java  # 图书列表Servlet
│   │   │       ├── UserListServlet.java  # 用户列表Servlet
│   │   │       └── CartServlet.java      # 购物车Servlet
│   │   ├── resources/
│   │   │   └── jdbc.properties     # 数据库配置文件
│   │   └── webapp/
│   │       ├── index.jsp           # 首页
│   │       ├── bookList.jsp        # 图书列表页面
│   │       ├── userList.jsp        # 用户列表页面
│   │       ├── cart.jsp            # 购物车页面
│   │       ├── static/             # 静态资源
│   │       ├── img/                # 图片资源
│   │       └── WEB-INF/
│   │           └── web.xml         # Web应用配置文件
```

### 3.2 技术架构

- **前端**: JSP + HTML + CSS
- **后端**: Servlet
- **数据模型**: JavaBean
- **数据库**: MySQL
- **构建工具**: Maven
- **服务器**: Jetty

## 4. 核心功能实现

### 4.1 实体类设计 (JavaBean)

**Book.java** - 图书实体类
- id: 图书ID
- name: 图书名称
- price: 图书价格
- bookCount: 图书库存数量
- author: 图书作者

**User.java** - 用户实体类
- id: 用户ID
- username: 用户名
- password: 密码
- email: 邮箱

### 4.2 数据访问层 (DAO)

**DataSourceUtil.java** - 数据库连接工具类
- 读取jdbc.properties配置文件
- 管理数据库连接的建立和关闭
- 实现连接池的基本功能

**DBUtils.java** - 数据库操作工具类
- 提供对图书表的增删改查操作
- 封装数据库访问逻辑
- 确保资源正确释放

### 4.3 控制层 (Servlet)

**BookListServlet.java** - 图书管理控制器
- 处理图书列表请求
- 调用DAO层获取图书数据
- 转发到图书列表JSP页面

**AddBookServlet.java** - 添加图书控制器
- 处理添加图书请求
- 验证图书信息
- 调用DAO层保存图书数据
- 重定向到图书列表页面

**GenerateBooksServlet.java** - 生成随机图书控制器
- 生成20本随机图书数据
- 批量添加到数据库
- 重定向到图书列表页面

**UserListServlet.java** - 用户管理控制器
- 处理用户列表请求
- 返回用户数据到视图层

**LoginServlet.java** - 用户登录控制器
- 处理用户登录请求
- 验证用户凭据
- 创建用户会话

**RegisterServlet.java** - 用户注册控制器
- 处理用户注册请求
- 验证用户信息
- 检查用户名唯一性
- 保存新用户到数据库

**LogoutServlet.java** - 用户注销控制器
- 销毁用户会话
- 重定向到首页

**CartServlet.java** - 购物车控制器
- 处理购物车相关请求

### 4.4 视图层 (JSP)

- index.jsp: 系统首页，提供导航到各功能模块
- bookList.jsp: 显示图书列表，支持编辑、删除、加入购物车操作
- addBook.jsp: 添加图书页面
- userList.jsp: 显示用户列表，支持编辑、删除操作
- login.jsp: 用户登录页面
- register.jsp: 用户注册页面
- cart.jsp: 购物车页面，显示添加到购物车的商品

### 4.5 过滤器

**encodingFilter.java** - 字符编码过滤器
- 解决中文乱码问题
- 统一设置请求和响应的字符编码

## 5. 数据库设计

根据实验要求，创建了以下数据表：

```sql
CREATE DATABASE `book`;
USE `book`;

-- 用户表
CREATE TABLE `t_user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(20) NOT NULL,
  `password` varchar(32) NOT NULL,
  `email` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;

-- 图书表
CREATE TABLE `t_book` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `price` decimal(11,2) DEFAULT NULL,
  `author` varchar(100) DEFAULT NULL,
  `sales` int(11) DEFAULT NULL,
  `stock` int(11) DEFAULT NULL,
  `img_path` varchar(200) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=23 DEFAULT CHARSET=utf8;

-- 订单表
CREATE TABLE `t_order` (
  `order_id` varchar(50) NOT NULL,
  `create_time` datetime DEFAULT NULL,
  `price` decimal(11,2) DEFAULT NULL,
  `status` int(11) DEFAULT NULL,
  `user_id` int(11) DEFAULT NULL,
  PRIMARY KEY (`order_id`),
  KEY `user_id` (`user_id`),
  CONSTRAINT `t_order_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `t_user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 订单项表
CREATE TABLE `t_order_item` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(100) DEFAULT NULL,
  `count` int(11) DEFAULT NULL,
  `price` decimal(11,2) DEFAULT NULL,
  `total_price` decimal(11,2) DEFAULT NULL,
  `order_id` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `order_id` (`order_id`),
  CONSTRAINT `t_order_item_ibfk_1` FOREIGN KEY (`order_id`) REFERENCES `t_order` (`order_id`)
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;
```

## 6. 配置文件

**pom.xml** - Maven项目配置文件
- 配置了Servlet API, JSP API, JSTL, MySQL连接器等依赖
- 配置了Jetty插件用于运行Web应用
- 设置了编译版本和打包插件

**jdbc.properties** - 数据库连接配置文件
- 配置数据库驱动、URL、用户名和密码

**web.xml** - Web应用部署描述符
- 配置了字符编码过滤器
- 配置了欢迎页面

## 7. 实验过程

### 7.1 项目搭建
1. 使用Maven创建Web项目骨架
2. 配置pom.xml添加所需依赖
3. 创建包结构（beans, dao, filter, servlet）
4. 配置Jetty插件以支持mvn jetty:run命令

### 7.2 实体类实现
按照JavaBean规范创建了Book和User实体类，实现了Serializable接口和克隆方法。

### 7.3 数据访问层实现
- 创建DataSourceUtil类管理数据库连接
- 实现DBUtils类封装CRUD操作
- 使用配置文件管理数据库连接参数

### 7.4 控制层实现
- 创建各个功能模块对应的Servlet
- 实现请求处理和页面转发逻辑
- 使用注解配置URL映射

### 7.5 视图层实现
- 创建JSP页面实现用户界面
- 使用JSTL和EL表达式显示数据
- 实现页面间的导航功能

## 8. 实验数据记录或图片

- **项目成功编译**: 执行`mvn clean compile`成功，无编译错误
- **服务器成功启动**: 执行`mvn jetty:run`成功启动Jetty服务器
- **页面访问测试**: curl测试显示服务器正常响应HTTP 200状态码
- **功能模块**: 
  - 首页: http://localhost:8080/iot-web-service/
  - 图书管理: http://localhost:8080/iot-web-service/servlet/bookList
  - 用户管理: http://localhost:8080/iot-web-service/servlet/userList
  - 购物车: http://localhost:8080/iot-web-service/servlet/cart

## 9. 实验结论

通过本次实验，我成功实现了以下目标：

1. **MVC架构实现**：采用JSP+JavaBean+Servlet模式构建Web应用，实现了模型、视图和控制器的分离，使代码结构清晰，职责分明。

2. **数据库连接**：通过JDBC API成功连接MySQL数据库，实现了数据的持久化存储和访问。使用配置文件管理数据库连接参数，提高了程序的可配置性。

3. **功能模块**：
   - 用户管理：实现了用户信息的展示功能
   - 图书管理：实现了图书信息的展示、新增、编辑、删除功能
   - 购物车功能：实现了商品加入购物车和订单生成的基本流程

4. **技术掌握**：
   - 熟练使用Maven进行项目构建和依赖管理
   - 掌握了Servlet开发技术
   - 理解了JSP页面开发和数据绑定
   - 学会了使用过滤器处理全局问题（如字符编码）

5. **开发流程**：通过本次实验，熟悉了完整Web应用的开发流程，从前端页面到后端逻辑，从数据库设计到部署运行。

## 10. 运行说明

要运行本项目，请按以下步骤操作：

1. 确保系统已安装JDK 8+和Maven
2. 安装MySQL数据库，创建名为`book`的数据库
3. 执行实验指导书中的SQL语句创建表结构（t_user, t_book, t_order, t_order_item）
4. 修改`src/main/resources/jdbc.properties`文件中的数据库连接信息（用户名、密码等）
5. 在项目根目录下执行命令：`mvn jetty:run`
6. 访问应用：`http://localhost:9090/iot-web-service/`

## 11. 修复说明

**修复的主要问题：**
1. 修复了数据库连接失败导致的NullPointerException
2. 修复了手动添加图书功能
3. 优化了数据库连接管理，确保连接正确开启和关闭
4. 添加了数据库表初始化功能

**新增的改进：**
1. 修复后添加图书功能正常工作
2. 数据库连接稳定可靠
3. 代码更加健壮，具有更好的错误处理

## 12. 总结与反思

本次实验让我深入理解了MVC设计模式在Web开发中的应用，掌握了使用Java技术栈开发Web应用的基本方法。项目成功运行，达到了实验要求的目标。在开发过程中也遇到了一些挑战，如字符编码问题、数据库连接配置、端口冲突等，通过查阅资料和调试逐步解决，提升了问题解决能力。

项目主要实现了以下功能：
- 用户注册/登录/注销功能
- 图书管理（增删改查）
- 用户管理（增删改查）
- 购物车功能
- 数据库连接与操作

项目完全采用MVC架构，代码结构清晰，模块划分合理，达到了实验要求的各项指标。

---
**成绩：**                                   **批阅教师：蒋琦**
**2026 年1月10日**